(function(){"use strict";function V(s){var a=s.createElement("style"),l=/([.*+?^${}()|\[\]\/\\])/g,h=/\bsf-dump-\d+-ref[012]\w+\b/,_=0<=navigator.platform.toUpperCase().indexOf("MAC")?"Cmd":"Ctrl",x=function(e,i,u){e.addEventListener(i,u,!1)};(s.documentElement.firstElementChild||s.documentElement.children[0]).appendChild(a),s.addEventListener||(x=function(e,i,u){e.attachEvent("on"+i,function(o){o.preventDefault=function(){o.returnValue=!1},o.target=o.srcElement,u(o)})});function E(e,i){var u=e.nextSibling||{},o=u.className,t,g;if(/\bsf-dump-compact\b/.test(o))t="\u25BC",g="sf-dump-expanded";else if(/\bsf-dump-expanded\b/.test(o))t="\u25B6",g="sf-dump-compact";else return!1;if(s.createEvent&&u.dispatchEvent){var f=s.createEvent("Event");f.initEvent(g==="sf-dump-expanded"?"sfbeforedumpexpand":"sfbeforedumpcollapse",!0,!1),u.dispatchEvent(f)}if(e.lastChild.innerHTML=t,u.className=u.className.replace(/\bsf-dump-(compact|expanded)\b/,g),i)try{for(e=u.querySelectorAll("."+o),u=0;u<e.length;++u)e[u].className.indexOf(g)==-1&&(e[u].className=g,e[u].previousSibling.lastChild.innerHTML=t)}catch{}return!0}function M(e,i){var u=e.nextSibling||{},o=u.className;return/\bsf-dump-expanded\b/.test(o)?(E(e,i),!0):!1}function c(e,i){var u=e.nextSibling||{},o=u.className;return/\bsf-dump-compact\b/.test(o)?(E(e,i),!0):!1}function y(e){var i=e.querySelector("a.sf-dump-toggle");return i?(M(i,!0),c(i),!0):!1}function H(e){for(var i,u=[];(e=e.parentNode||{})&&(i=e.previousSibling)&&i.tagName==="A";)u.push(i);return u.length!==0?(u.forEach(function(o){c(o)}),!0):!1}function D(e,i,u){b(e),Array.from(u||[]).forEach(function(o){/\bsf-dump-highlight\b/.test(o.className)||(o.className=o.className+" sf-dump-highlight")}),/\bsf-dump-highlight-active\b/.test(i.className)||(i.className=i.className+" sf-dump-highlight-active")}function b(e){Array.from(e.querySelectorAll(".sf-dump-str, .sf-dump-key, .sf-dump-public, .sf-dump-protected, .sf-dump-private")).forEach(function(i){i.className=i.className.replace(/\bsf-dump-highlight\b/,""),i.className=i.className.replace(/\bsf-dump-highlight-active\b/,"")})}return function(e,i){e=s.getElementById(e);for(var u=new RegExp("^("+(e.getAttribute("data-indent-pad")||"  ").replace(l,"\\$1")+")+","m"),o={maxDepth:1,maxStringLength:160,fileLinkFormat:!1},t=e.getElementsByTagName("A"),g=t.length,f=0,T,q,S=[];f<g;)S.push(t[f++]);for(f in i)o[f]=i[f];function d(p,m){x(e,p,function(n,r){n.target.tagName=="A"?m(n.target,n):n.target.parentNode.tagName=="A"?m(n.target.parentNode,n):(r=/\bsf-dump-ellipsis\b/.test(n.target.className)?n.target.parentNode:n.target,(r=r.nextElementSibling)&&r.tagName=="A"&&(/\bsf-dump-toggle\b/.test(r.className)||(r=r.nextElementSibling||r),m(r,n,!0)))})}function L(p){return p.ctrlKey||p.metaKey}function R(p){var m=p.match(/[^'"]+|['"]/g).map(function(n){return n=="'"?`"'"`:n=='"'?`'"'`:"'"+n+"'"});return"concat("+m.join(",")+", '')"}function X(p){return"contains(concat(' ', normalize-space(@class), ' '), ' "+p+" ')"}for(x(e,"mouseover",function(p){a.innerHTML!=""&&(a.innerHTML="")}),d("mouseover",function(p,m,n){if(n)m.target.style.cursor="pointer";else if(p=h.exec(p.className))try{a.innerHTML="pre.sf-dump ."+p[0]+"{background-color: #B729D9; color: #FFF !important; border-radius: 2px}"}catch{}}),d("click",function(p,m,n){if(/\bsf-dump-toggle\b/.test(p.className)){if(m.preventDefault(),!E(p,L(m))){var r=s.getElementById(p.getAttribute("href").substr(1)),k=r.previousSibling,v=r.parentNode,C=p.parentNode;C.replaceChild(r,p),v.replaceChild(p,k),C.insertBefore(k,r),v=v.firstChild.nodeValue.match(u),C=C.firstChild.nodeValue.match(u),v&&C&&v[0]!==C[0]&&(r.innerHTML=r.innerHTML.replace(new RegExp("^"+v[0].replace(l,"\\$1"),"mg"),C[0])),/\bsf-dump-compact\b/.test(r.className)&&E(k,L(m))}if(!n)if(s.getSelection)try{s.getSelection().removeAllRanges()}catch{s.getSelection().empty()}else s.selection.empty()}else/\bsf-dump-str-toggle\b/.test(p.className)&&(m.preventDefault(),m=p.parentNode.parentNode,m.className=m.className.replace(/\bsf-dump-str-(expand|collapse)\b/,p.parentNode.className))}),t=e.getElementsByTagName("SAMP"),g=t.length,f=0;f<g;)S.push(t[f++]);for(g=S.length,f=0;f<g;++f)if(t=S[f],t.tagName=="SAMP"){d=t.previousSibling||{},d.tagName!="A"?(d=s.createElement("A"),d.className="sf-dump-ref",t.parentNode.insertBefore(d,t)):d.innerHTML+=" ",d.title=(d.title?d.title+`
[`:"[")+_+"+click] Expand all children",d.innerHTML+="<span>\u25BC</span>",d.className+=" sf-dump-toggle",i=1,t.parentNode.className!="sf-dump"&&(i+=t.parentNode.getAttribute("data-depth")/1),t.setAttribute("data-depth",i);var B=t.className;t.className="sf-dump-expanded",(B?B!=="sf-dump-expanded":i>o.maxDepth)&&E(d)}else if(/\bsf-dump-ref\b/.test(t.className)&&(d=t.getAttribute("href"))&&(d=d.substr(1),t.className+=" "+d,/[\[{]$/.test(t.previousSibling.nodeValue))){d=d!=t.nextSibling.id&&s.getElementById(d);try{T=d.nextSibling,t.appendChild(d),T.parentNode.insertBefore(d,T),/^[@#]/.test(t.innerHTML)?t.innerHTML+=" <span>\u25B6</span>":(t.innerHTML="<span>\u25B6</span>",t.className="sf-dump-ref"),t.className+=" sf-dump-toggle"}catch{t.innerHTML.charAt(0)=="&"&&(t.innerHTML="\u2026",t.className="sf-dump-ref")}}if(s.evaluate&&Array.from&&e.children.length>1){let m=function(n){var r=n.current(),k,v;r&&(H(r),D(e,r,n.nodes),"scrollIntoView"in r&&(r.scrollIntoView(!0),k=r.getBoundingClientRect(),v=N.getBoundingClientRect(),k.top<v.top+v.height&&window.scrollBy(0,-(v.top+v.height+5)))),$.textContent=(n.isEmpty()?0:n.idx+1)+" of "+n.count()};e.setAttribute("tabindex",0);let p=function(){this.nodes=[],this.idx=0};p.prototype={next:function(){return this.isEmpty()?this.current():(this.idx=this.idx<this.nodes.length-1?this.idx+1:0,this.current())},previous:function(){return this.isEmpty()?this.current():(this.idx=this.idx>0?this.idx-1:this.nodes.length-1,this.current())},isEmpty:function(){return this.count()===0},current:function(){return this.isEmpty()?null:this.nodes[this.idx]},reset:function(){this.nodes=[],this.idx=0},count:function(){return this.nodes.length}};var N=s.createElement("div");N.className="sf-dump-search-wrapper sf-dump-search-hidden",N.innerHTML=`
                <input type="text" class="sf-dump-search-input">
                <span class="sf-dump-search-count">0 of 0</span>
                <button type="button" class="sf-dump-search-input-previous" tabindex="-1">
                    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1683 1331l-166 165q-19 19-45 19t-45-19L896 965l-531 531q-19 19-45 19t-45-19l-166-165q-19-19-19-45.5t19-45.5l742-741q19-19 45-19t45 19l742 741q19 19 19 45.5t-19 45.5z"/></svg>
                </button>
                <button type="button" class="sf-dump-search-input-next" tabindex="-1">
                    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1683 808l-742 741q-19 19-45 19t-45-19L109 808q-19-19-19-45.5t19-45.5l166-165q19-19 45-19t45 19l531 531 531-531q19-19 45-19t45 19l166 165q19 19 19 45.5t-19 45.5z"/></svg>
                </button>
            `,e.insertBefore(N,e.firstChild);var w=new p,A=N.querySelector(".sf-dump-search-input"),$=N.querySelector(".sf-dump-search-count"),O=0,F="";x(A,"keyup",function(n){var r=n.target.value;r!==F&&(F=r,clearTimeout(O),O=setTimeout(function(){if(w.reset(),y(e),b(e),r===""){$.textContent="0 of 0";return}var k=["sf-dump-str","sf-dump-key","sf-dump-public","sf-dump-protected","sf-dump-private"].map(X).join(" or "),v=s.evaluate(".//span["+k+"][contains(translate(child::text(), "+R(r.toUpperCase())+", "+R(r.toLowerCase())+"), "+R(r.toLowerCase())+")]",e,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);let C;for(;C=v.iterateNext();)w.nodes.push(C);m(w)},400))}),Array.from(N.querySelectorAll(".sf-dump-search-input-next, .sf-dump-search-input-previous")).forEach(function(n){x(n,"click",function(r){r.preventDefault(),r.target.className.indexOf("next")!==-1?w.next():w.previous(),A.focus(),y(e),m(w)})}),x(e,"keydown",function(n){var r=!/\bsf-dump-search-hidden\b/.test(N.className);if(n.keyCode===114&&!r||L(n)&&n.keyCode===70){if(n.keyCode===70&&document.activeElement===A)return;n.preventDefault(),N.className=N.className.replace(/\bsf-dump-search-hidden\b/,""),A.focus()}else r&&(n.keyCode===27?(N.className+=" sf-dump-search-hidden",n.preventDefault(),b(e),A.value=""):(L(n)&&n.keyCode===71||n.keyCode===13||n.keyCode===114)&&(n.preventDefault(),n.shiftKey?w.previous():w.next(),y(e),m(w)))})}if(!(0>=o.maxStringLength))try{for(t=e.querySelectorAll(".sf-dump-str"),g=t.length,f=0,S=[];f<g;)S.push(t[f++]);for(g=S.length,f=0;f<g;++f)t=S[f],T=t.innerText||t.textContent,i=T.length-o.maxStringLength,0<i&&(q=t.innerHTML,t[t.innerText?"innerText":"textContent"]=T.substring(0,o.maxStringLength),t.className+=" sf-dump-str-collapse",t.innerHTML="<span class=sf-dump-str-collapse>"+q+'<a class="sf-dump-ref sf-dump-str-toggle" title="Collapse"> \u25C0</a></span><span class=sf-dump-str-expand>'+t.innerHTML+'<a class="sf-dump-ref sf-dump-str-toggle" title="'+i+' remaining characters"> \u25B6</a></span>')}catch{}}}const W="";function z(s,a,l,h,_,x,E,M){var c=typeof s=="function"?s.options:s;a&&(c.render=a,c.staticRenderFns=l,c._compiled=!0),h&&(c.functional=!0),x&&(c._scopeId="data-v-"+x);var y;if(E?(y=function(b){b=b||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!b&&typeof __VUE_SSR_CONTEXT__<"u"&&(b=__VUE_SSR_CONTEXT__),_&&_.call(this,b),b&&b._registeredComponents&&b._registeredComponents.add(E)},c._ssrRegister=y):_&&(y=M?function(){_.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:_),y)if(c.functional){c._injectStyles=y;var H=c.render;c.render=function(e,i){return y.call(i),H(e,i)}}else{var D=c.beforeCreate;c.beforeCreate=D?[].concat(D,y):[y]}return{exports:s,options:c}}const P={props:{headline:String,timeout:Number,muted:Boolean},computed:{parsedDumps(){return this.dumps.map(s=>JSON.parse(s)).reverse()}},data(){return{dumpTimeout:null,firstDump:!0,dumps:[],dump:null,ready:!1,sfDump:null,triggered:[],flushSound:new Audio("/media/plugins/sietseveenman/kirby3-toilet/flush.mp3"),farts:[new Audio("/media/plugins/sietseveenman/kirby3-toilet/fart-1.mp3"),new Audio("/media/plugins/sietseveenman/kirby3-toilet/fart-2.mp3"),new Audio("/media/plugins/sietseveenman/kirby3-toilet/fart-3.mp3"),new Audio("/media/plugins/sietseveenman/kirby3-toilet/fart-4.mp3"),new Audio("/media/plugins/sietseveenman/kirby3-toilet/fart-5.mp3"),new Audio("/media/plugins/sietseveenman/kirby3-toilet/fart-6.mp3")]}},mounted(){this.sfDump=V(document),this.addStyles(),this.receiveDumps()},destroyed(){clearTimeout(this.dumpTimeout)},methods:{addStyles(){let s=document.createElement("style");s.innerText="pre.sf-dump .sf-dump-compact, .sf-dump-str-collapse .sf-dump-str-collapse, .sf-dump-str-expand .sf-dump-str-expand { display: none; }",document.head.append(s)},flush(){this.$api.post("flush").then(s=>{var a;s.success?(this.muted||(a=this.flushSound)==null||a.play(),this.dumps.splice(0)):console.err("Something went wrong flushing")}).catch(s=>{console.err(s)})},removeDump(s){this.$api.post("remove-dump/"+s).then(a=>{if(a.success){const l=this.dumps.map(h=>JSON.parse(h).timestamp).indexOf(s);this.dumps.splice(l,1)}else console.err("Something went wrong removing: ",JSON.parse(this.dumps.dumpIndex))}).catch(a=>{console.err(a)})},receiveDumps(){this.dumpTimeout=setTimeout(()=>{console.log("check"),this.$api.get("receive-fresh-dumps",this.firstDump?{initial:!0}:{}).then(s=>{var a;this.firstDump=!1,(a=s.dumps)!=null&&a.length&&(s.dumps.forEach(l=>this.dumps.push(l)),this.$nextTick(this.triggerDumps),this.muted||this.farts[Math.floor(Math.random()*this.farts.length)].play().then().catch(l=>console.info("Not alowed to play sound yet:",l))),this.receiveDumps()}).catch(s=>{console.err(s)})},this.firstDump?50:this.timeout)},triggerDumps(){const s=this.$refs.dump;!s||s.forEach(a=>{const h=a.querySelector(".sf-dump[id]").id;this.triggered.includes(h)||(this.sfDump(h),this.triggered.push(h))})}}};var I=function(){var a=this,l=a._self._c;return l("k-inside",[l("k-view",{staticClass:"k-toilet-view"},[l("div",{staticClass:"container"},[l("div",{staticClass:"header"},[l("k-headline",{attrs:{size:"large"}},[a._v("Don't forget to wash your hands")]),l("button",{directives:[{name:"show",rawName:"v-show",value:a.parsedDumps.length>1,expression:"parsedDumps.length > 1"}],staticClass:"flush",on:{click:a.flush}},[l("k-icon",{staticClass:"icon",attrs:{type:"refresh"}}),a._v(" Flush ")],1)],1),a._l(a.parsedDumps,function(h,_){return l("div",{key:h.timestamp,staticClass:"dump"},[l("div",{staticClass:"meta"},[l("k-text",{staticClass:"timestamp",attrs:{size:"tiny"}},[l("k-icon",{staticClass:"icon",attrs:{type:"clock"}}),l("span",[a._v(a._s(h.time))])],1),l("button",{staticClass:"remove",on:{click:function(x){return a.removeDump(h.timestamp)}}},[l("k-icon",{attrs:{type:"remove"}})],1)],1),l("div",{staticClass:"print"},[h.label?l("k-headline",{staticClass:"label"},[a._v(a._s(h.label))]):a._e(),l("div",{ref:"dump",refInFor:!0,attrs:{"data-index":_},domProps:{innerHTML:a._s(h.fecal_matter)}})],1)])})],2)])],1)},K=[],U=z(P,I,K,!1,null,null,null,null);const J=U.exports;panel.plugin("sietseveenman/kirby3-toilet",{components:{toilet:J}})})();
